<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS æ’­æ”¾æœ¬åœ°éŸ³é¢‘ | Summer Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="äº§å“åŒå­¦æƒ³è¦å®ç°ä¸€ä¸ªåŠŸèƒ½:ç”¨æˆ·å®ŒæˆæŸä¸ªä»»åŠ¡æ—¶,è¿›è¡Œè¯­éŸ³æç¤º. äºæ˜¯è¿™ä¸ªç®€å•çš„è¦æ±‚,æŠ˜ç£¨æˆ‘3å¤©(ï¼›â€²âŒ’`), å®è·µè¯æ˜,å¼€å‘ä¹‹å‰çš„å……åˆ†è°ƒç ”èƒ½å¤Ÿå°‘èµ°å¼¯è·¯; å¼€å‘ç»éªŒä¹Ÿçš„ç¡®èƒ½å¤Ÿç¼©çŸ­å¼€å‘æ—¶é—´


é‚£äº›è‡ªå·±å°è¯•(zou)è¿‡(guo)çš„(de)æ–¹(wan)æ³•(lu)ğŸ’¨
å®šæ—¶å£°éŸ³æ¨é€(UILocalNotification), ç±»ä¼¼é—¹é’Ÿçš„åŠŸèƒ½,åˆ°äº†æŒ‡å®šæ—¶é—´å,å“èµ·ä¸€æ®µéŸ³ä¹. ç„¶è€Œè¿™æ ·åšçš„é—®é¢˜åœ¨äº,å¹¶ä¸çŸ¥é“ç”¨">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS æ’­æ”¾æœ¬åœ°éŸ³é¢‘">
<meta property="og:url" content="http://yoursite.com/2016/10/24/iOS-æ’­æ”¾æœ¬åœ°éŸ³é¢‘/index.html">
<meta property="og:site_name" content="Summer Blog">
<meta property="og:description" content="äº§å“åŒå­¦æƒ³è¦å®ç°ä¸€ä¸ªåŠŸèƒ½:ç”¨æˆ·å®ŒæˆæŸä¸ªä»»åŠ¡æ—¶,è¿›è¡Œè¯­éŸ³æç¤º. äºæ˜¯è¿™ä¸ªç®€å•çš„è¦æ±‚,æŠ˜ç£¨æˆ‘3å¤©(ï¼›â€²âŒ’`), å®è·µè¯æ˜,å¼€å‘ä¹‹å‰çš„å……åˆ†è°ƒç ”èƒ½å¤Ÿå°‘èµ°å¼¯è·¯; å¼€å‘ç»éªŒä¹Ÿçš„ç¡®èƒ½å¤Ÿç¼©çŸ­å¼€å‘æ—¶é—´


é‚£äº›è‡ªå·±å°è¯•(zou)è¿‡(guo)çš„(de)æ–¹(wan)æ³•(lu)ğŸ’¨
å®šæ—¶å£°éŸ³æ¨é€(UILocalNotification), ç±»ä¼¼é—¹é’Ÿçš„åŠŸèƒ½,åˆ°äº†æŒ‡å®šæ—¶é—´å,å“èµ·ä¸€æ®µéŸ³ä¹. ç„¶è€Œè¿™æ ·åšçš„é—®é¢˜åœ¨äº,å¹¶ä¸çŸ¥é“ç”¨">
<meta property="og:updated_time" content="2016-10-24T10:07:23.062Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS æ’­æ”¾æœ¬åœ°éŸ³é¢‘">
<meta name="twitter:description" content="äº§å“åŒå­¦æƒ³è¦å®ç°ä¸€ä¸ªåŠŸèƒ½:ç”¨æˆ·å®ŒæˆæŸä¸ªä»»åŠ¡æ—¶,è¿›è¡Œè¯­éŸ³æç¤º. äºæ˜¯è¿™ä¸ªç®€å•çš„è¦æ±‚,æŠ˜ç£¨æˆ‘3å¤©(ï¼›â€²âŒ’`), å®è·µè¯æ˜,å¼€å‘ä¹‹å‰çš„å……åˆ†è°ƒç ”èƒ½å¤Ÿå°‘èµ°å¼¯è·¯; å¼€å‘ç»éªŒä¹Ÿçš„ç¡®èƒ½å¤Ÿç¼©çŸ­å¼€å‘æ—¶é—´


é‚£äº›è‡ªå·±å°è¯•(zou)è¿‡(guo)çš„(de)æ–¹(wan)æ³•(lu)ğŸ’¨
å®šæ—¶å£°éŸ³æ¨é€(UILocalNotification), ç±»ä¼¼é—¹é’Ÿçš„åŠŸèƒ½,åˆ°äº†æŒ‡å®šæ—¶é—´å,å“èµ·ä¸€æ®µéŸ³ä¹. ç„¶è€Œè¿™æ ·åšçš„é—®é¢˜åœ¨äº,å¹¶ä¸çŸ¥é“ç”¨">
  
    <link rel="alternate" href="/atom.xml" title="Summer Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Summer Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-iOS-æ’­æ”¾æœ¬åœ°éŸ³é¢‘" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/24/iOS-æ’­æ”¾æœ¬åœ°éŸ³é¢‘/" class="article-date">
  <time datetime="2016-10-24T10:05:02.000Z" itemprop="datePublished">2016-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iOS æ’­æ”¾æœ¬åœ°éŸ³é¢‘
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<font color="#0099ff" size="3" face="é»‘ä½“">äº§å“åŒå­¦æƒ³è¦å®ç°ä¸€ä¸ªåŠŸèƒ½:ç”¨æˆ·å®ŒæˆæŸä¸ªä»»åŠ¡æ—¶,è¿›è¡Œè¯­éŸ³æç¤º. äºæ˜¯è¿™ä¸ªç®€å•çš„è¦æ±‚,æŠ˜ç£¨æˆ‘3å¤©(ï¼›â€²âŒ’`), å®è·µè¯æ˜,å¼€å‘ä¹‹å‰çš„å……åˆ†è°ƒç ”èƒ½å¤Ÿå°‘èµ°å¼¯è·¯; å¼€å‘ç»éªŒä¹Ÿçš„ç¡®èƒ½å¤Ÿç¼©çŸ­å¼€å‘æ—¶é—´</font>

</blockquote>
<h2 id="é‚£äº›è‡ªå·±å°è¯•-zou-è¿‡-guo-çš„-de-æ–¹-wan-æ³•-lu-ğŸ’¨"><a href="#é‚£äº›è‡ªå·±å°è¯•-zou-è¿‡-guo-çš„-de-æ–¹-wan-æ³•-lu-ğŸ’¨" class="headerlink" title="é‚£äº›è‡ªå·±å°è¯•(zou)è¿‡(guo)çš„(de)æ–¹(wan)æ³•(lu)ğŸ’¨"></a>é‚£äº›è‡ªå·±å°è¯•(zou)è¿‡(guo)çš„(de)æ–¹(wan)æ³•(lu)ğŸ’¨</h2><ul>
<li>å®šæ—¶å£°éŸ³æ¨é€(UILocalNotification), ç±»ä¼¼é—¹é’Ÿçš„åŠŸèƒ½,åˆ°äº†æŒ‡å®šæ—¶é—´å,å“èµ·ä¸€æ®µéŸ³ä¹. ç„¶è€Œè¿™æ ·åšçš„é—®é¢˜åœ¨äº,å¹¶ä¸çŸ¥é“ç”¨æˆ·ä»€ä¹ˆæ—¶å€™åšä»»åŠ¡; ä¸”ä»»åŠ¡åˆ‡å‡ºç•Œé¢å,ä»»åŠ¡éœ€è¦ç»“æŸ. æœ¬åœ°é€šçŸ¥ä¸èƒ½æ»¡è¶³è¦æ±‚Ë‡ËË‡ ,æ”¾å¼ƒ</li>
<li>AVAudioPlayeræ’­æ”¾æœ¬åœ°éŸ³é¢‘, è¿™ä¸ªå¥½,æ£’æäº†,å¼€å‘å®Œä¹‹å,å‘ç°äº§å“éœ€è¦éŸ³ä¹èƒ½å¤Ÿåå°é…ç½®(è®ºè¯»æ‡‚éœ€æ±‚çš„é‡è¦æ€§),ä¸”éŸ³ä¹æ—¶é•¿ä¹Ÿè®¸ä¼šè¶…è¿‡30s. å†å¼ƒ</li>
<li>æœ€åé€‰æ‹©äº†AVPlayer</li>
</ul>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>1.AVAudioPlayerå’ŒAVPlayerå£°æ˜å¯¹è±¡éƒ½éœ€è¦è®¾ç½®æˆå…¨å±€å˜é‡<br>2.AVAudioPlayerå’ŒAVPlayeréƒ½éœ€è¦å¼•å…¥AVFoundationæ¡†æ¶<br>3.iOS9å¼•å…¥äº†æ–°ç‰¹æ€§App Transport Security (ATS),éœ€è¦åœ¨plistä¸­æ·»åŠ æƒé™. æ·»åŠ æ–¹å¼:å·¦é”®Info.plisté€‰æ‹©open with source code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">	&lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;</span><br><span class="line">	&lt;true/&gt;</span><br><span class="line">&lt;/dict&gt;</span><br></pre></td></tr></table></figure>
<h2 id="å†™ä»£ç "><a href="#å†™ä»£ç " class="headerlink" title="å†™ä»£ç "></a>å†™ä»£ç </h2><p>1.åŠ è½½éŸ³é¢‘æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//æ’­æ”¾æœ¬åœ°éŸ³é¢‘</span><br><span class="line">  NSString *filePath = [[NSBundle mainBundle] pathForResource:@&quot;ç‹¬è§’æˆ&quot;  ofType:@&quot;mp3&quot;];</span><br><span class="line">  NSURL *sourceMovieUrl =  [NSURL fileURLWithPath:filePath];</span><br><span class="line">  //æ’­æ”¾ç½‘ç»œéŸ³é¢‘</span><br><span class="line">  //NSURL *sourceMovieUrl = [NSURL URLWithString:urlString]</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç ä¸­æœ¬åœ°éŸ³é¢‘å’Œåœ¨çº¿éŸ³é¢‘çš„ä¸»è¦åŒºåˆ«åœ¨äºè·¯å¾„çš„ä¸åŒ:æœ¬åœ°è·¯å¾„ä½¿ç”¨<code>[NSURL fileURLWithPath:æœ¬åœ°éŸ³é¢‘è·¯å¾„]</code>,åœ¨çº¿éŸ³é¢‘ä½¿ç”¨<code>[NSURL URLWithString:åœ¨çº¿éŸ³ä¹åœ°å€]</code></p>
<p>2.åˆ›å»ºAVPlayer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AVAsset *movieAsset = [AVURLAsset URLAssetWithURL:sourceMovieUrl options:nil];</span><br><span class="line">self.timerPlayerItem = [AVPlayerItem playerItemWithAsset:movieAsset];</span><br><span class="line"></span><br><span class="line">//è¿™æ˜¯ç”¨æ¥æ”¯æŒåå°æ’­æ”¾çš„</span><br><span class="line">AVAudioSession *audioSession = [AVAudioSession sharedInstance];</span><br><span class="line">NSError *setCategoryError = nil;</span><br><span class="line">[audioSession setCategory:AVAudioSessionCategoryPlayback error:&amp;setCategoryError];</span><br><span class="line"></span><br><span class="line">[audioSession setActive:YES error:nil];</span><br><span class="line">if (setCategoryError) &#123;</span><br><span class="line">    NSLog(@&quot;è¿™é‡Œæœ‰é—®é¢˜ %@&quot;,setCategoryError);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">self.timerPlayer = [[AVPlayer alloc]initWithPlayerItem:self.timerPlayerItem];</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†éŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„,å‰©ä¸‹çš„å°±æ˜¯å°†éŸ³ä¹æ’­æ”¾å‡ºæ¥äº†.ä¸Šé¢çš„ä»£ç æœ‰ä¿©ä¸ªä½œç”¨:1.åˆ›å»ºAVAudioSessionä½¿å¾—æ’­æ”¾å™¨æ”¯æŒåå°æ’­æ”¾ 2.åˆ›å»ºéŸ³é¢‘æ’­æ”¾å™¨. å…¶ä¸­ä»£ç ä¸­ç”¨åˆ°çš„<code>AVAsset</code>æ˜¯ä¸ªæŠ½è±¡ç±»,ä¸èƒ½å¤Ÿå•ç‹¬ä½¿ç”¨.</p>
<p>3.æ’­æ”¾</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[self.timerPlayer play];</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä»…ä»…æ˜¯æ’­æ”¾éŸ³ä¹,ä¸Šé¢çš„ä»£ç å°±è¶³å¤Ÿäº†,ä½†å¾€å¾€æ’­æ”¾éŸ³ä¹åè¿˜éœ€è¦è®¸å¤šæ“ä½œ,æ¯”å¦‚éŸ³ä¹å®Œæˆåç•Œé¢éœ€è¦æç¤ºå•Š,éŸ³ä¹æ’­æ”¾è¿›åº¦ç­‰ç­‰. äºæ˜¯å°±æœ‰äº†ä¸‹é¢çš„ç›‘å¬</p>
<p>4.æ·»åŠ å’Œç§»é™¤ç›‘å¬</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//æ·»åŠ ç›‘å¬</span><br><span class="line">- (void)addObserverForPlayerItem</span><br><span class="line">&#123;</span><br><span class="line">    [self.timerPlayer.currentItem addObserver:self forKeyPath:@&quot;status&quot; options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld context:nil];</span><br><span class="line">    [self.timerPlayer.currentItem addObserver:self forKeyPath:@&quot;loadedTimeRanges&quot; options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld context:nil];</span><br><span class="line">    </span><br><span class="line">    //æ·»åŠ éŸ³ä¹æ’­æ”¾å®Œæˆçš„é€šçŸ¥</span><br><span class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(itemDidFinishPlaying) name:AVPlayerItemDidPlayToEndTimeNotification object:self.timerPlayer.currentItem];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç§»é™¤ç›‘å¬</span><br><span class="line">- (void)removeObserverForPlayerItem</span><br><span class="line">&#123;</span><br><span class="line">    [self.timerPlayer.currentItem removeObserver:self forKeyPath:@&quot;status&quot;];</span><br><span class="line">    [self.timerPlayer.currentItem removeObserver:self forKeyPath:@&quot;loadedTimeRanges&quot;];</span><br><span class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self name:AVPlayerItemDidPlayToEndTimeNotification object:self.timerPlayer.currentItem];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç åˆ©ç”¨KVOå±æ€§ç›‘å¬äº†<code>status</code>å’Œ<code>loadedTimeRanges</code>å±æ€§,å¹¶æ·»åŠ äº†<code>AVPlayerItemDidPlayToEndTimeNotification</code>é€šçŸ¥;<code>status</code>æ˜¯å¯¹playerçš„çŠ¶æ€çš„æšä¸¾å€¼,å½“<code>status = readytoplay</code>æ—¶å€™æ‰èƒ½æ’­æ”¾èµ„æºæˆ–è¿›è¡Œå…¶ä»–çš„ç•Œé¢å¤„ç†,<code>loadedTimeRanges</code>çš„å±æ€§ç›‘å¬å¯ä»¥è·å¾—å½“å‰èµ„æºçš„ç¼“å†²è¿›åº¦.ä¸‹é¢æ˜¯å¯¹å±æ€§ç›‘å¬åçš„æ“ä½œç¤ºä¾‹å’Œæ”¶åˆ°<code>AVPlayerItemDidPlayToEndTimeNotification</code>é€šçŸ¥åæ‰§è¡Œçš„æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context</span><br><span class="line">&#123;</span><br><span class="line">    if ([keyPath isEqualToString:@&quot;status&quot;]) &#123;</span><br><span class="line">        int status = ((NSNumber *)change[@&quot;new&quot;]).intValue;</span><br><span class="line">        if (status == AVPlayerStatusReadyToPlay) &#123;</span><br><span class="line">            //è¿›è¡Œç›¸åº”çš„ç•Œé¢å¤„ç†</span><br><span class="line">            NSLog(@&quot;hehehheeh&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;else if ([keyPath isEqualToString:@&quot;loadedTimeRanges&quot;])&#123;</span><br><span class="line">        NSArray *array = self.timerPlayer.currentItem.loadedTimeRanges;</span><br><span class="line">        CMTimeRange timeRanges = [array.firstObject CMTimeRangeValue];</span><br><span class="line">        float startSeconds =  CMTimeGetSeconds(timeRanges.start);</span><br><span class="line">        float durationSeconds = CMTimeGetSeconds(timeRanges.duration);</span><br><span class="line">        //è·å–ç¼“å†²æ—¶é—´</span><br><span class="line">        float bufferTime = startSeconds + durationSeconds;</span><br><span class="line">        NSLog(@&quot;%f&quot;,bufferTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)itemDidFinishPlaying</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;ç»ˆäºå®Œäº‹äº†&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®Œæˆäº†ä¸Šé¢è¿™äº›ä»£ç ,åŸºæœ¬èƒ½å¤Ÿæ»¡è¶³äº§å“å¯¹äºæ’­æ”¾éŸ³ä¹çš„éœ€æ±‚äº†.ä½†æ˜¯è€ƒè™‘åˆ°é…ç½®çš„æç¤ºéŸ³å¹¶ä¸é•¿,æ‰€ä»¥é¢†å¯¼å¸Œæœ›éŸ³é¢‘ç¼“å­˜åˆ°æœ¬åœ°åå†è¿›è¡Œæ’­æ”¾,æ‰€ä»¥æ¥ä¸‹æ¥éœ€è¦ä¸‹è½½éŸ³ä¹æ–‡ä»¶</p>
<h2 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h2><p>1.è®¾ç½®æœ¬åœ°æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> ä¸‹è½½åçš„éŸ³é¢‘å­˜æ”¾è·¯å¾„</span><br><span class="line"></span><br><span class="line"> @param fileName         æ–‡ä»¶åç§°</span><br><span class="line"> @param isFileExistBlock å›è°ƒ</span><br><span class="line"> */</span><br><span class="line">- (void)audioFilePath:(NSString *)fileName</span><br><span class="line">          isFileExist:(void(^)(BOOL isExist, NSString*savePath))isFileExistBlock</span><br><span class="line">&#123;</span><br><span class="line">    NSString *cachePath=[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject];</span><br><span class="line">    </span><br><span class="line">    NSString *savePath=[cachePath stringByAppendingPathComponent:[NSString stringWithFormat:@&quot;audio_%@&quot;,fileName]];</span><br><span class="line">    NSLog(@&quot;%@&quot;,savePath);</span><br><span class="line">    </span><br><span class="line">    //é¦–å…ˆåˆ¤æ–­å½“å‰è·¯å¾„æ˜¯å¦å­˜åœ¨</span><br><span class="line">    NSFileManager *fileManager = [NSFileManager defaultManager];</span><br><span class="line">    BOOL isPathExist = [fileManager fileExistsAtPath:savePath];</span><br><span class="line">    if (isPathExist)</span><br><span class="line">    &#123;</span><br><span class="line">        //å­˜åœ¨ç›¸åŒçš„æ–‡ä»¶</span><br><span class="line">        if (isFileExistBlock) &#123; isFileExistBlock(YES, savePath); &#125;</span><br><span class="line"></span><br><span class="line">    &#125;else</span><br><span class="line">    &#123;</span><br><span class="line">        if (isFileExistBlock) &#123; isFileExistBlock(NO, savePath); &#125;</span><br><span class="line">        //åˆ¤æ–­å½“å‰è·¯å¾„ä¸‹æ–‡ä»¶ä¸ªæ•°,ä¸ªæ•°å¤§äº5æ—¶,åˆ é™¤æ–‡ä»¶</span><br><span class="line">        NSArray *array = [fileManager contentsOfDirectoryAtPath:savePath error:nil];</span><br><span class="line">        if (array.count &gt; 4)</span><br><span class="line">        &#123;</span><br><span class="line">            [fileManager removeItemAtPath:savePath error:nil];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†ä»£ç åšäº†ä¸€ä¸ªå¯¹ç¼“å­˜æ–‡ä»¶çš„ç®€å•åˆ¤æ–­:å½“ç¼“å­˜æ–‡ä»¶å·²ç»å­˜åœ¨çš„æ—¶å€™,è¿”å›æ ‡è¯†ç¬¦YES;ç¼“å­˜æ–‡ä»¶æ•°é‡å¤§äº4æ—¶åˆ é™¤æ²™ç›’ä¸­çš„æ–‡ä»¶</p>
<p>2.ä¸‹è½½èµ„æº</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> æ ¹æ®é“¾æ¥åœ°å€ä¸‹è½½éŸ³é¢‘</span><br><span class="line"></span><br><span class="line"> @param urlString ä¸‹è½½</span><br><span class="line"> @param block     block</span><br><span class="line"> */</span><br><span class="line">- (void)downLoadAudioWithUrlString:(NSString *)urlString</span><br><span class="line">                     downloadBlock:(DownloadAudioFinishBlock)block</span><br><span class="line">&#123;</span><br><span class="line">   // NSURL *soundURL = [NSURL URLWithString:@&quot;http://yinyueshiting.baidu.com/data2/music/122873158/4904681476817261128.mp3?xcode=1276ea4c54f0c8f829676627b54cb918&quot;];</span><br><span class="line">    NSURL *soundURL = [NSURL URLWithString:urlString];</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;soundURL:%@&quot;,soundURL);</span><br><span class="line">    </span><br><span class="line">    //å°†è·¯å¾„æ‹†åˆ†æˆarray,ç„¶åä¿å­˜æ–‡ä»¶åç§°</span><br><span class="line">    NSArray *seperateArray = [urlString componentsSeparatedByString:@&quot;/&quot;];</span><br><span class="line">    NSString *fileName = seperateArray.lastObject;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    [self audioFilePath:fileName isFileExist:^(BOOL isExist, NSString *savePath)</span><br><span class="line">     &#123;</span><br><span class="line">         //å­˜åœ¨æ–‡ä»¶</span><br><span class="line">         if (isExist)&#123;</span><br><span class="line">             if (block) &#123; block(savePath, nil);&#125;</span><br><span class="line">         &#125;</span><br><span class="line">         //ä¸å­˜åœ¨æ–‡ä»¶</span><br><span class="line">         else</span><br><span class="line">         &#123;</span><br><span class="line">             //åˆ›å»ºç½‘ç»œè¯·æ±‚</span><br><span class="line">             NSMutableURLRequest *theRequest = [NSMutableURLRequest requestWithURL:soundURL];</span><br><span class="line">             NSURLSession *session  = [NSURLSession sharedSession];</span><br><span class="line">             </span><br><span class="line">             //æ ¹æ®é“¾æ¥åœ°å€ä¸‹è½½éŸ³é¢‘åˆ°æŒ‡å®šåœ°å€</span><br><span class="line">             NSURLSessionDownloadTask *downloadTask = [session downloadTaskWithRequest:theRequest completionHandler:^(NSURL * _Nullable location, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123;</span><br><span class="line">                 if (!error) &#123;</span><br><span class="line">                     </span><br><span class="line">                     //æ³¨æ„locationæ˜¯ä¸‹è½½åçš„ä¸´æ—¶ä¿å­˜è·¯å¾„,éœ€è¦å°†å®ƒç§»åŠ¨åˆ°éœ€è¦ä¿å­˜çš„ä½ç½®</span><br><span class="line">                     </span><br><span class="line">                      NSError *saveError;</span><br><span class="line">                      //å­˜å‚¨æ–‡ä»¶</span><br><span class="line">                      NSURL *saveUrl=[NSURL fileURLWithPath:savePath];</span><br><span class="line">                      [[NSFileManager defaultManager] copyItemAtURL:location toURL:saveUrl error:</span><br><span class="line">                       &amp;saveError];</span><br><span class="line">                      if (!saveError) &#123;</span><br><span class="line">                          NSLog(@&quot;save sucess.&quot;);</span><br><span class="line">                          if (block) &#123; block(savePath, nil);&#125;</span><br><span class="line">                      &#125;else&#123;</span><br><span class="line">                          NSLog(@&quot;error is :%@&quot;,saveError.localizedDescription);</span><br><span class="line">                          if (block) &#123; block(nil, saveError);&#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                 </span><br><span class="line">                 &#125;else&#123;</span><br><span class="line">                     NSLog(@&quot;error is :%@&quot;,error.localizedDescription);</span><br><span class="line">                     </span><br><span class="line">                     if ([error.localizedDescription containsString:@&quot; already exists&quot;]) &#123;</span><br><span class="line">                         if (block) &#123; block(savePath, nil);&#125;</span><br><span class="line">                     &#125;else&#123;</span><br><span class="line">                         if (block) &#123; block(nil, error);&#125;</span><br><span class="line"></span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;</span><br><span class="line">                 </span><br><span class="line">             &#125;];</span><br><span class="line">             [downloadTask resume];</span><br><span class="line"></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¸­çš„urlæ˜¯ä»ç™¾åº¦ä¸­æ‰¾åˆ°çš„éŸ³ä¹ä¸‹è½½åœ°å€,è¿™é‡Œä¸‹è½½éŸ³ä¹å’Œæ–‡ä»¶æ˜¯ä¸€æ ·çš„,å¦‚æœç½‘é€Ÿå¤ªæ…¢,å»ºè®®æ‰¾ä¸ªçŸ­ç‚¹çš„éŸ³ä¹æˆ–è€…æ–‡ä»¶ä¹‹ç±».æ­¤å¤„å­˜æ”¾éŸ³ä¹çš„åç§°ä¸ºurlæˆªå–çš„ä¸€éƒ¨åˆ†. è¿™æ ·ä¸‹è½½æ–‡ä»¶å°±å®Œæˆå•¦.</p>
<p><a href="https://github.com/XQ0820/PlayAudio" target="_blank" rel="external">ä¸Šé¢æ–‡ç« çš„ä»£ç æ”¾åœ¨è¿™é‡Œäº†:</a></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¹‹å‰å¬æç¬‘æ¥è€å¸ˆçš„è®²åº§,ä»–æåˆ°â€è¾“å‡ºèƒ½å¤Ÿæœ‰æ•ˆåœ°æ¨åŠ¨è¾“å…¥â€. è‡ªå·±å†™è¿™ç¯‡æ–‡ç« ç•¥ç•¥èƒ½æ„Ÿå—åˆ°è¿™ä¸€ç‚¹,å¹³æ—¶è¯»åˆ«äººçš„æŠ€æœ¯åšå®¢æ€»æ˜¯3~5åˆ†é’Ÿå°±çœ‹è¿‡å»äº†,ç°åœ¨æƒ³æƒ³åº”è¯¥å¥½å¥½æ„Ÿè°¢æ‰€æœ‰ç»™è‡ªå·±æä¾›è¿‡å¸®åŠ©çš„åšå®¢.æœ‰äº†è°·æ­Œ,å°±å¥½åƒæ‹¥æœ‰æ•´ä¸ªå®‡å®™,ä¹Ÿå¸Œæœ›èƒ½é€šè¿‡åšå®¢çš„å½¢å¼ç»™è‡ªå·±å¢åŠ ä¸€äº›æ–°é²œçš„æ„Ÿå—,å’Œå¤šä¸€äº›è¿›æ­¥.</p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p>Haleâ€™s Blog: <a href="http://wuqiuhao.github.io/2016/04/05/iOS%E8%A7%86%E9%A2%91%E3%80%81%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE/" target="_blank" rel="external">http://wuqiuhao.github.io/2016/04/05/iOS%E8%A7%86%E9%A2%91%E3%80%81%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE/</a><br>iOS éŸ³é¢‘æ’­æ”¾ â€”â€” ç¦»çº¿æ­Œæ›²:<a href="http://www.jianshu.com/p/2fdc6a9142c4" target="_blank" rel="external">http://www.jianshu.com/p/2fdc6a9142c4</a><br>ç å†œäººç”ŸéŸ³é¢‘æ’­æ”¾ç³»åˆ—(å¤§ç¥çš„æ–‡ç« ç‰›ç‰›å“’!):<a href="http://msching.github.io/blog/2014/07/08/audio-in-ios-2/" target="_blank" rel="external">http://msching.github.io/blog/2014/07/08/audio-in-ios-2/</a><br>AVAudioPlayer,AVPlayerä»¥åŠç³»ç»ŸéŸ³é¢‘:<a href="http://www.jianshu.com/p/e5dbd92871a4" target="_blank" rel="external">http://www.jianshu.com/p/e5dbd92871a4</a><br>iOSéŸ³é¢‘ç¯‡ï¼šä½¿ç”¨AVPlayeræ’­æ”¾ç½‘ç»œéŸ³ä¹:<a href="http://www.jianshu.com/p/32b932f44c9b" target="_blank" rel="external">http://www.jianshu.com/p/32b932f44c9b</a><br>iOS Programming 101: Record and Play Audio using AVFoundation Framework:<a href="https://www.appcoda.com/ios-avfoundation-framework-tutorial/" target="_blank" rel="external">https://www.appcoda.com/ios-avfoundation-framework-tutorial/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/24/iOS-æ’­æ”¾æœ¬åœ°éŸ³é¢‘/" data-id="cix09o9pk0001hcuxqsvjbcx8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/12/16/å‘çƒ§ä»¥å/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          å‘çƒ§ä»¥å ^_^
        
      </div>
    </a>
  
  
    <a href="/2016/10/17/iOS10ç”¨æˆ·é€šçŸ¥æ¡†æ¶-User-Notifications-ç®€ä»‹-ç¿»è¯‘/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">iOS10ç”¨æˆ·é€šçŸ¥æ¡†æ¶(User Notifications)ç®€ä»‹(ç¿»è¯‘)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/22/èŠ‚æ—¥/">èŠ‚æ—¥</a>
          </li>
        
          <li>
            <a href="/2016/12/22/å°æ’æ›²/">å°æ’æ›²</a>
          </li>
        
          <li>
            <a href="/2016/12/20/æ˜¾å¾®é•œä¸‹çš„å¤§æ˜/">æ˜¾å¾®é•œä¸‹çš„å¤§æ˜</a>
          </li>
        
          <li>
            <a href="/2016/12/20/ä¹ æƒ¯/">ä¹ æƒ¯</a>
          </li>
        
          <li>
            <a href="/2016/12/19/ç”Ÿæ´»åœ¨åˆ«å¤„/">ç”Ÿæ´»åœ¨åˆ«å¤„</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Summer<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>